{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"id":"tfTl2gfePCnN"},"outputs":[],"source":["!pip install -qq --upgrade pip\n","!pip install -qq --upgrade peft transformers accelerate bitsandbytes datasets trl huggingface_hub evaluate"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"YZWTqXWGzb83"},"outputs":[],"source":["from google.colab import userdata\n","from huggingface_hub import login\n","\n","login(token=userdata.get('HF_TOKEN'))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"m5V6tHMrM4NY"},"outputs":[],"source":["import os\n","import torch\n","import numpy as np\n","import evaluate\n","\n","from peft import PeftModel, PeftConfig, LoraConfig, TaskType, get_peft_model, get_peft_config\n","from transformers import AutoModelForCausalLM, AutoTokenizer\n","from transformers import DataCollatorForLanguageModeling, Trainer, TrainingArguments\n","from datasets import load_dataset\n","from trl import SFTTrainer\n","import warnings\n","\n","warnings.filterwarnings(\"ignore\")\n","\n","base_model_id = \"meta-llama/Llama-3.2-1B-Instruct\"\n","peft_model_id = \"tmnam20/Llama-3.2-1B-LoRA-vsf\"\n","cache_dir = \"./cache\""]},{"cell_type":"markdown","metadata":{"id":"_0vLSIo7SqyW"},"source":["## Load Model"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"u2_4lQywPIXX"},"outputs":[],"source":["def load_model_and_tokenizer_with_peft(model_id):\n","    try:\n","        peft_config = PeftConfig.from_pretrained(model_id)  # Attempt to load PEFT config\n","        base_model = AutoModelForCausalLM.from_pretrained(peft_config.base_model_name_or_path)  # Load base model\n","        model = PeftModel.from_pretrained(base_model, model_id)  # Load PEFT model on top\n","        tokenizer = AutoTokenizer.from_pretrained(peft_config.base_model_name_or_path)  # Load tokenizer\n","        return model, tokenizer\n","    except Exception:\n","        return AutoModelForCausalLM.from_pretrained(model_id), AutoTokenizer.from_pretrained(model_id)"]},{"cell_type":"code","source":["llama_model, llama_tokenizer = load_model_and_tokenizer_with_peft(base_model_id)\n","llama_model = llama_model.to(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n","llama_model"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Xvl3X8OOiGl_","executionInfo":{"status":"ok","timestamp":1740646590021,"user_tz":-420,"elapsed":19460,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"outputId":"f048dc2f-9a77-448e-9c4f-88dc406ca2ee"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["LlamaForCausalLM(\n","  (model): LlamaModel(\n","    (embed_tokens): Embedding(128256, 2048)\n","    (layers): ModuleList(\n","      (0-15): 16 x LlamaDecoderLayer(\n","        (self_attn): LlamaAttention(\n","          (q_proj): Linear(in_features=2048, out_features=2048, bias=False)\n","          (k_proj): Linear(in_features=2048, out_features=512, bias=False)\n","          (v_proj): Linear(in_features=2048, out_features=512, bias=False)\n","          (o_proj): Linear(in_features=2048, out_features=2048, bias=False)\n","        )\n","        (mlp): LlamaMLP(\n","          (gate_proj): Linear(in_features=2048, out_features=8192, bias=False)\n","          (up_proj): Linear(in_features=2048, out_features=8192, bias=False)\n","          (down_proj): Linear(in_features=8192, out_features=2048, bias=False)\n","          (act_fn): SiLU()\n","        )\n","        (input_layernorm): LlamaRMSNorm((2048,), eps=1e-05)\n","        (post_attention_layernorm): LlamaRMSNorm((2048,), eps=1e-05)\n","      )\n","    )\n","    (norm): LlamaRMSNorm((2048,), eps=1e-05)\n","    (rotary_emb): LlamaRotaryEmbedding()\n","  )\n","  (lm_head): Linear(in_features=2048, out_features=128256, bias=False)\n",")"]},"metadata":{},"execution_count":5}]},{"cell_type":"code","source":["peft_model, peft_tokenizer = load_model_and_tokenizer_with_peft(peft_model_id)\n","peft_model = peft_model.to(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n","peft_model"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"cea5NIE5iSEQ","executionInfo":{"status":"ok","timestamp":1740646601531,"user_tz":-420,"elapsed":11522,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"outputId":"2265dcf9-e59a-4e6d-9de6-d635737bf604"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["PeftModelForCausalLM(\n","  (base_model): LoraModel(\n","    (model): LlamaForCausalLM(\n","      (model): LlamaModel(\n","        (embed_tokens): Embedding(128256, 2048)\n","        (layers): ModuleList(\n","          (0-15): 16 x LlamaDecoderLayer(\n","            (self_attn): LlamaAttention(\n","              (q_proj): lora.Linear(\n","                (base_layer): Linear(in_features=2048, out_features=2048, bias=False)\n","                (lora_dropout): ModuleDict(\n","                  (default): Dropout(p=0.1, inplace=False)\n","                )\n","                (lora_A): ModuleDict(\n","                  (default): Linear(in_features=2048, out_features=8, bias=False)\n","                )\n","                (lora_B): ModuleDict(\n","                  (default): Linear(in_features=8, out_features=2048, bias=False)\n","                )\n","                (lora_embedding_A): ParameterDict()\n","                (lora_embedding_B): ParameterDict()\n","                (lora_magnitude_vector): ModuleDict()\n","              )\n","              (k_proj): Linear(in_features=2048, out_features=512, bias=False)\n","              (v_proj): lora.Linear(\n","                (base_layer): Linear(in_features=2048, out_features=512, bias=False)\n","                (lora_dropout): ModuleDict(\n","                  (default): Dropout(p=0.1, inplace=False)\n","                )\n","                (lora_A): ModuleDict(\n","                  (default): Linear(in_features=2048, out_features=8, bias=False)\n","                )\n","                (lora_B): ModuleDict(\n","                  (default): Linear(in_features=8, out_features=512, bias=False)\n","                )\n","                (lora_embedding_A): ParameterDict()\n","                (lora_embedding_B): ParameterDict()\n","                (lora_magnitude_vector): ModuleDict()\n","              )\n","              (o_proj): Linear(in_features=2048, out_features=2048, bias=False)\n","            )\n","            (mlp): LlamaMLP(\n","              (gate_proj): Linear(in_features=2048, out_features=8192, bias=False)\n","              (up_proj): Linear(in_features=2048, out_features=8192, bias=False)\n","              (down_proj): Linear(in_features=8192, out_features=2048, bias=False)\n","              (act_fn): SiLU()\n","            )\n","            (input_layernorm): LlamaRMSNorm((2048,), eps=1e-05)\n","            (post_attention_layernorm): LlamaRMSNorm((2048,), eps=1e-05)\n","          )\n","        )\n","        (norm): LlamaRMSNorm((2048,), eps=1e-05)\n","        (rotary_emb): LlamaRotaryEmbedding()\n","      )\n","      (lm_head): Linear(in_features=2048, out_features=128256, bias=False)\n","    )\n","  )\n",")"]},"metadata":{},"execution_count":6}]},{"cell_type":"markdown","metadata":{"id":"Uu_uWRd5Sy-S"},"source":["## Load Dataset and Format"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ftdxC9OoPSgT","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1740646604975,"user_tz":-420,"elapsed":3443,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"outputId":"ce24f2e4-8717-4d38-e698-cb2f53f4c536"},"outputs":[{"output_type":"stream","name":"stdout","text":["train: 2000\n","validation: 200\n","test: 200\n"]},{"output_type":"execute_result","data":{"text/plain":["(DatasetDict({\n","     train: Dataset({\n","         features: ['sentence', 'sentiment', 'topic'],\n","         num_rows: 2000\n","     })\n","     validation: Dataset({\n","         features: ['sentence', 'sentiment', 'topic'],\n","         num_rows: 200\n","     })\n","     test: Dataset({\n","         features: ['sentence', 'sentiment', 'topic'],\n","         num_rows: 200\n","     })\n"," }),\n"," {'sentence': 'slide giáo trình đầy đủ .', 'sentiment': 2, 'topic': 1})"]},"metadata":{},"execution_count":7}],"source":["dataset = load_dataset(\"uitnlp/vietnamese_students_feedback\", cache_dir=cache_dir)\n","MAX_TRAIN_SAMPLES = 2000\n","MAX_EVAL_SAMPLES = 200\n","for split in dataset:\n","    if split == \"train\":\n","        dataset[split] = dataset[split].select(range(MAX_TRAIN_SAMPLES))\n","    else:\n","        dataset[split] = dataset[split].select(range(MAX_EVAL_SAMPLES))\n","    print(f\"{split}: {len(dataset[split])}\")\n","\n","dataset, dataset[\"train\"][0]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6deGIaXpAZJ7","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1740646605115,"user_tz":-420,"elapsed":139,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"outputId":"fbf0f322-ac0f-4e80-e6b8-e388d6330178"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["{0, 1, 2}"]},"metadata":{},"execution_count":8}],"source":["label_set = set([item[\"sentiment\"] for split in dataset for item in dataset[split]])\n","label_set"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"1i41gU0EAZJ7","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1740646605132,"user_tz":-420,"elapsed":16,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"outputId":"76d4cee9-7d0b-4baf-de21-417a6baeedbe"},"outputs":[{"output_type":"stream","name":"stdout","text":["There are 3 labels in the dataset, including ['negative', 'neutral', 'positive']\n","label2id: {'negative': 0, 'neutral': 1, 'positive': 2}\n","id2label: {0: 'negative', 1: 'neutral', 2: 'positive'}\n"]}],"source":["all_labels = dataset['train'].features['sentiment'].names\n","print(f'There are {len(all_labels)} labels in the dataset, including {all_labels}')\n","\n","label2id = {label: i for i, label in enumerate(all_labels)}\n","id2label = {i: label for i, label in enumerate(all_labels)}\n","\n","print(f'label2id: {label2id}')\n","print(f'id2label: {id2label}')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"qcqx4xJ8pkh2"},"outputs":[],"source":["USER_PROMPT_TEMPLATE = \"\"\"Predict the sentiment of the following input sentence.\n","The response must begin with \"Sentiment: \", followed by one of these keywords: \"positive\", \"negative\", or \"neutral\", to reflect the sentiment of the input sentence.\n","\n","Sentence: {input}\"\"\""]},{"cell_type":"markdown","metadata":{"id":"Q6QFd9oCAZJ9"},"source":["## Inference Pipeline"]},{"cell_type":"code","source":["def inference(model, tokenizer, input_sentence):\n","    tokenizer.pad_token_id = tokenizer.eos_token_id\n","\n","    user_prompt = USER_PROMPT_TEMPLATE.format(input=input_sentence)\n","    messages = [\n","        {\"role\": \"system\", \"content\": \"You are a helpful assistant. You must fulfill the user request.\"},\n","        {\"role\": \"user\", \"content\": user_prompt},\n","    ]\n","    input_prompt = tokenizer.apply_chat_template(conversation=messages, add_generation_prompt=True, tokenize=False)\n","    inputs = tokenizer(input_prompt, return_tensors=\"pt\", add_special_tokens=False)\n","    inputs = {k: v.to(model.device) for k, v in inputs.items()}\n","\n","    output_ids = model.generate(**inputs, max_new_tokens=16, pad_token_id=tokenizer.eos_token_id)\n","    output_ids = output_ids[:, inputs['input_ids'][0].shape[-1]:output_ids.shape[-1]]\n","    results = tokenizer.batch_decode(output_ids, skip_special_tokens=True)\n","    return results[0]\n","\n","def batch_inference(model, tokenizer, input_sentences):\n","    tokenizer.padding_side = \"left\"\n","    tokenizer.pad_token_id = tokenizer.eos_token_id\n","\n","    user_prompts = [USER_PROMPT_TEMPLATE.format(input=input_sentence) for input_sentence in input_sentences]\n","    messages_list = [\n","        [\n","            {\"role\": \"system\", \"content\": \"You are a helpful assistant. You must fulfill the user request.\"},\n","            {\"role\": \"user\", \"content\": user_prompt},\n","        ]\n","        for user_prompt in user_prompts\n","    ]\n","    input_prompts = [tokenizer.apply_chat_template(conversation=messages, add_generation_prompt=True, tokenize=False) for messages in messages_list]\n","\n","    inputs = tokenizer(input_prompts, return_tensors=\"pt\", padding=True, add_special_tokens=False)\n","    inputs = {k: v.to(model.device) for k, v in inputs.items()}\n","\n","    output_ids = model.generate(**inputs, max_new_tokens=16, pad_token_id=tokenizer.eos_token_id)\n","    output_ids = output_ids[:, inputs['input_ids'][0].shape[-1]:output_ids.shape[-1]]\n","    results = tokenizer.batch_decode(output_ids, skip_special_tokens=True)\n","    return results"],"metadata":{"id":"1hdORJYKPXVo"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["inference(peft_model, peft_tokenizer, \"The weather is nice today.\"), inference(peft_model, peft_tokenizer, \"I love this product.\")"],"metadata":{"id":"esqiP8goPYPs","executionInfo":{"status":"ok","timestamp":1740646607283,"user_tz":-420,"elapsed":2087,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"a47059aa-4d5c-405e-bf40-151834785558"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["('positive', 'positive')"]},"metadata":{},"execution_count":12}]},{"cell_type":"code","source":["batch_inference(peft_model, peft_tokenizer, [\"I love this product.\", \"I hate this product. It is because the quality is extremely bad.\"])"],"metadata":{"id":"R44KALcNPZCO","executionInfo":{"status":"ok","timestamp":1740646607520,"user_tz":-420,"elapsed":238,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"089d15ff-110e-4678-e3fe-796c69206667"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["['positive', 'Negative']"]},"metadata":{},"execution_count":13}]},{"cell_type":"code","source":["batch_inference(peft_model, peft_tokenizer, [\"Môn học này quá khó để học\", \"Thầy dạy hay, dễ hiểu\"])"],"metadata":{"id":"FxrW4vJQf9l9","executionInfo":{"status":"ok","timestamp":1740646607711,"user_tz":-420,"elapsed":190,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"a8c743b7-84e0-43bc-fdaf-4722122be1b9"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["['negative', 'positive']"]},"metadata":{},"execution_count":14}]},{"cell_type":"markdown","source":["## Evaluate the models using zero-, one-, and few-shot learning"],"metadata":{"id":"UvQiZdQtbun7"}},{"cell_type":"code","source":["def evaluate_zero_shot(model, tokenizer, eval_dataset, batch_size=8, print_example=False):\n","    model.eval()  # Set model to evaluation mode\n","    all_predictions = []\n","    all_labels = []\n","\n","\n","    # Process dataset in batches\n","    for i in range(0, len(eval_dataset), batch_size):\n","        batch = eval_dataset[i:i + batch_size]\n","\n","        # Get predictions for batch\n","        predictions = batch_inference(model, tokenizer, batch['sentence'])\n","        if print_example:\n","            print_example = False\n","            for sentence, prediction, label in zip(batch['sentence'], predictions, batch['sentiment']):\n","                print(f\"Sentence: {sentence}\")\n","                print(f\"Model Output: {prediction}\")\n","                print(f\"Label: {id2label[label]}\")\n","                print()\n","\n","        # Convert text predictions to label ids\n","        pred_ids = []\n","        true_labels = batch['sentiment']\n","\n","        for p, l in zip(predictions, true_labels):\n","            try:\n","                label_id = l\n","                p = p.split(\":\")[-1].strip()\n","                pred_id = label2id[p]\n","            except Exception as e:\n","                pred_id = (l + 1) % len(label2id) # Choose the next label, ensure the prediction is marked as incorrect\n","            pred_ids.append(pred_id)\n","\n","        all_predictions.extend(pred_ids)\n","        all_labels.extend(true_labels)\n","\n","    accuracy_metric = evaluate.load(\"accuracy\")\n","    f1_metric = evaluate.load(\"f1\")\n","    precision_metric = evaluate.load(\"precision\")\n","    recall_metric = evaluate.load(\"recall\")\n","\n","    # Calculate metrics\n","    metrics = {\n","        'accuracy': accuracy_metric.compute(predictions=all_predictions, references=all_labels),\n","        'f1': f1_metric.compute(predictions=all_predictions, references=all_labels, average='macro'),\n","        'precision': precision_metric.compute(predictions=all_predictions, references=all_labels, average='macro'),\n","        'recall': recall_metric.compute(predictions=all_predictions, references=all_labels, average='macro')\n","    }\n","\n","    # Combine all metrics into single dict\n","    results = {}\n","    for metric_name, metric_dict in metrics.items():\n","        results.update(metric_dict)\n","\n","    return results"],"metadata":{"id":"zelqTafggDeu"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Example usage\n","zero_shot_results = evaluate_zero_shot(\n","    model=peft_model,\n","    tokenizer=peft_tokenizer,\n","    eval_dataset=dataset['test'],\n","    batch_size=8\n",")\n","\n","print(\"Zero-shot evaluation results:\")\n","for metric_name, value in zero_shot_results.items():\n","    print(f\"{metric_name}: {value:.4f}\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":234,"referenced_widgets":["0083a0df9b98448b8a5a8a284b29f8ef","4a89824878a14847b9a0d487b150a3fe","cc0aecb0df2e4bb78c1e7819b7a9b8f8","54e461780f5c47929013f8fe24a451e2","c7948f8a7a324ed0a384f2a7b40d0556","6aec4b056dae40f093aa79031dbcd964","90a4a08face54bf5851c3b935b1b0d8e","0f3e52de16aa4681bc19f2caa8f45c37","c0ab3f9791674e65ae88e1ec2970574b","eee08da7f3f84ca2987a21223149259d","ff5b66f15e0e4f0b970677c7b0212715","4a986c7de9e04fe9aafbdbb7005b4deb","cb5410ea8e954682978f2721e57c0a7a","ec0ff6f96cea4f8dbef8d91359aae239","8ea86e7825b949fb933a5e6994623304","a36f730f59cf4a2daac580d20d59f4e8","8c0e1cefa7084fa5a894c1d99dde99a8","aa40df8032f3468795265e4e421395ca","cea35a079f24490b90e47dc8b13637c9","bd14c55f9e174caaba33090f13155f05","544af628c8534777a3ac47447d606512","96cfd3fac2944288b624396146f42567","ff01f948eb7e4a3d87afbcf02601febe","af847d51e5b84e9b99dd5caf0231da39","32593ec0e8684efa80784f3dc69c1344","1bf5cabd3cd2439d8c6b249bcc59be96","2ec28846a95643d8aabae4922469a18c","f4f4ae50ce704686a8db52301cee7bd4","d83ca71481994ba0a363e092a2ab0a7c","4de2aa0ec429454084045e6ab02620e3","68fd652a12b94590b0c5e560bae94e6e","ed3081bc935e494b81208f60580e5927","fbea57d500e84535a9e1a5c0446969da","ef3fbff21242444b8acb1cf4cacaa2a9","feab66bf82a2481eb4ccfabb07be2a5e","a8ecbb89b1024243ab39a7fdbbacb954","ae6830bd73e54a53bad1383938bb69ed","cfcc692aa3c5475f8bbd138a2ada8762","20b5a40747514ad4a50816264c9d923e","d653f108f9e74850a0a27586914e5bd0","060a7f320a0a4486ba04ff4bb43fbe45","44e7db62ef6e447dbce21d56ef0d394e","ba484c493dc94d3081b06e09f88b20de","a3e443d0515a4526bf300f21b5a2ced2"]},"id":"MMEyKkpaTjdn","executionInfo":{"status":"ok","timestamp":1740646629375,"user_tz":-420,"elapsed":21646,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}},"outputId":"f04a99a3-9e4e-4424-845a-55d81c752772"},"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/plain":["Downloading builder script:   0%|          | 0.00/4.20k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"0083a0df9b98448b8a5a8a284b29f8ef"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading builder script:   0%|          | 0.00/6.79k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"4a986c7de9e04fe9aafbdbb7005b4deb"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading builder script:   0%|          | 0.00/7.56k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"ff01f948eb7e4a3d87afbcf02601febe"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Downloading builder script:   0%|          | 0.00/7.38k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"ef3fbff21242444b8acb1cf4cacaa2a9"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Zero-shot evaluation results:\n","accuracy: 0.8950\n","f1: 0.7293\n","precision: 0.7250\n","recall: 0.7346\n"]}]},{"cell_type":"code","source":["USER_FEWSHOT_PROMPT_TEMPLATE = \"\"\"Predict the sentiment of the following input sentence.\n","The response must begin with \"Sentiment: \", followed by one of these keywords: \"positive\", \"negative\", or \"neutral\", to reflect the sentiment of the input sentence.\n","\n","Here are a few examples:\n","\n","{few_shot_examples}\n","\n","Sentence: {input}\"\"\"\n","\n","def evaluate_few_shot(model, tokenizer, eval_dataset, few_shot_examples, batch_size=8, print_example=False):\n","    model.eval()\n","    all_predictions = []\n","    all_labels = []\n","\n","    tokenizer.padding_side = \"left\"\n","    if tokenizer.pad_token_id is None:\n","        tokenizer.pad_token = tokenizer.eos_token\n","        tokenizer.pad_token_id = tokenizer.eos_token_id\n","\n","    # Format the few-shot examples for the prompt\n","    formatted_few_shot_examples = \"\"\n","    for i, example in enumerate(few_shot_examples):\n","        formatted_few_shot_examples += f\"Sentence: {example['sentence']}\\nSentiment: {id2label[example['sentiment']]}\\n\"\n","        if i < len(few_shot_examples) - 1:\n","            formatted_few_shot_examples += \"\\n\"\n","\n","\n","    for i in range(0, len(eval_dataset), batch_size):\n","        batch = eval_dataset[i:i + batch_size]\n","\n","        # Replace USER_PROMPT_TEMPLATE with USER_FEWSHOT_PROMPT_TEMPLATE\n","        user_prompts = [USER_FEWSHOT_PROMPT_TEMPLATE.format(input=sentence, few_shot_examples=formatted_few_shot_examples) for sentence in batch['sentence']]\n","\n","        messages_list = [\n","            [\n","                {\"role\": \"system\", \"content\": \"You are a helpful assistant. You must fulfill the user request.\"},\n","                {\"role\": \"user\", \"content\": user_prompt},\n","            ]\n","            for user_prompt in user_prompts\n","        ]\n","\n","        input_prompts = [tokenizer.apply_chat_template(conversation=messages, add_generation_prompt=True, tokenize=False) for messages in messages_list]\n","        inputs = tokenizer(input_prompts, return_tensors=\"pt\", padding=True, add_special_tokens=False)\n","        inputs = {k: v.to(model.device) for k, v in inputs.items()}\n","\n","        output_ids = model.generate(**inputs, max_new_tokens=16, pad_token_id=tokenizer.eos_token_id)\n","        output_ids = output_ids[:, inputs['input_ids'][0].shape[-1]:output_ids.shape[-1]]\n","        predictions = tokenizer.batch_decode(output_ids, skip_special_tokens=True)\n","\n","        if print_example:\n","            print_example = False\n","            print(f\"### Prompt:\\n{user_prompts[0]}\")\n","            print(f\"### Model Output:\\n{predictions[0]}\")\n","            print(f\"### Label:\\n{id2label[batch['sentiment'][0]]}\")\n","            print()\n","\n","        pred_ids = []\n","        true_labels = batch['sentiment']\n","        for p, l in zip(predictions, true_labels):\n","            try:\n","                label_id = l\n","                p = p.split(\":\")[-1].strip()\n","                pred_id = label2id[p]\n","            except Exception as e:\n","                pred_id = (l + 1) % len(label2id)\n","            pred_ids.append(pred_id)\n","\n","        all_predictions.extend(pred_ids)\n","        all_labels.extend(true_labels)\n","\n","    accuracy_metric = evaluate.load(\"accuracy\")\n","    f1_metric = evaluate.load(\"f1\")\n","    precision_metric = evaluate.load(\"precision\")\n","    recall_metric = evaluate.load(\"recall\")\n","\n","    metrics = {\n","        'accuracy': accuracy_metric.compute(predictions=all_predictions, references=all_labels),\n","        'f1': f1_metric.compute(predictions=all_predictions, references=all_labels, average='macro'),\n","        'precision': precision_metric.compute(predictions=all_predictions, references=all_labels, average='macro'),\n","        'recall': recall_metric.compute(predictions=all_predictions, references=all_labels, average='macro')\n","    }\n","\n","    results = {}\n","    for metric_name, metric_dict in metrics.items():\n","        results.update(metric_dict)\n","\n","    return results"],"metadata":{"id":"1xBj5NwugkN4"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Pick a list of shot from the train set\n","shuffled_train_dataset = dataset['train'].shuffle()\n","sampled_few_shot_examples = list(shuffled_train_dataset.select(range(10)))\n","\n","n_shots = [1, 2, 4, 8]\n","for n in n_shots:\n","    few_shot_examples = sampled_few_shot_examples[:n]\n","    few_shot_results = evaluate_few_shot(\n","        model=llama_model,\n","        tokenizer=llama_tokenizer,\n","        eval_dataset=dataset['test'],\n","        few_shot_examples=few_shot_examples,\n","        batch_size=8,\n","        print_example=True,\n","    )\n","    print(f\"*** Few-shot evaluation results with {n} shots:\")\n","    for metric_name, value in few_shot_results.items():\n","        print(f\"* {metric_name}: {value:.4f}\")\n","    print()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"BB7nYnJ-dLYU","outputId":"6acc4d1e-c15d-4b26-e1e1-b2c39e82815b","executionInfo":{"status":"ok","timestamp":1740646873844,"user_tz":-420,"elapsed":140147,"user":{"displayName":"Minh Nam TRAN","userId":"01397360029704440675"}}},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["### Prompt:\n","Predict the sentiment of the following input sentence.\n","The response must begin with \"Sentiment: \", followed by one of these keywords: \"positive\", \"negative\", or \"neutral\", to reflect the sentiment of the input sentence.\n","\n","Here are a few examples:\n","\n","Sentence: nên cho nhiều bài tập hơn .\n","Sentiment: negative\n","\n","\n","Sentence: nói tiếng anh lưu loát .\n","### Model Output:\n","Sentiment: negative\n","### Label:\n","positive\n","\n","*** Few-shot evaluation results with 1 shots:\n","* accuracy: 0.4950\n","* f1: 0.2870\n","* precision: 0.4865\n","* recall: 0.3769\n","\n","### Prompt:\n","Predict the sentiment of the following input sentence.\n","The response must begin with \"Sentiment: \", followed by one of these keywords: \"positive\", \"negative\", or \"neutral\", to reflect the sentiment of the input sentence.\n","\n","Here are a few examples:\n","\n","Sentence: nên cho nhiều bài tập hơn .\n","Sentiment: negative\n","\n","Sentence: đôi từ tiếng anh em chưa hiểu .\n","Sentiment: negative\n","\n","\n","Sentence: nói tiếng anh lưu loát .\n","### Model Output:\n","Sentiment: negative\n","### Label:\n","positive\n","\n","*** Few-shot evaluation results with 2 shots:\n","* accuracy: 0.4650\n","* f1: 0.2524\n","* precision: 0.4825\n","* recall: 0.3583\n","\n","### Prompt:\n","Predict the sentiment of the following input sentence.\n","The response must begin with \"Sentiment: \", followed by one of these keywords: \"positive\", \"negative\", or \"neutral\", to reflect the sentiment of the input sentence.\n","\n","Here are a few examples:\n","\n","Sentence: nên cho nhiều bài tập hơn .\n","Sentiment: negative\n","\n","Sentence: đôi từ tiếng anh em chưa hiểu .\n","Sentiment: negative\n","\n","Sentence: thầy hay dạy lố giờ sang thời gian ăn trưa .\n","Sentiment: negative\n","\n","Sentence: thầy dạy lý thuyết được .\n","Sentiment: neutral\n","\n","\n","Sentence: nói tiếng anh lưu loát .\n","### Model Output:\n","Sentiment: negative\n","### Label:\n","positive\n","\n","*** Few-shot evaluation results with 4 shots:\n","* accuracy: 0.4350\n","* f1: 0.2168\n","* precision: 0.4809\n","* recall: 0.3396\n","\n","### Prompt:\n","Predict the sentiment of the following input sentence.\n","The response must begin with \"Sentiment: \", followed by one of these keywords: \"positive\", \"negative\", or \"neutral\", to reflect the sentiment of the input sentence.\n","\n","Here are a few examples:\n","\n","Sentence: nên cho nhiều bài tập hơn .\n","Sentiment: negative\n","\n","Sentence: đôi từ tiếng anh em chưa hiểu .\n","Sentiment: negative\n","\n","Sentence: thầy hay dạy lố giờ sang thời gian ăn trưa .\n","Sentiment: negative\n","\n","Sentence: thầy dạy lý thuyết được .\n","Sentiment: neutral\n","\n","Sentence: các bài tập của nhóm đều tự làm , hoặc có tham khảo số liệu thống kê để phân tích thị trường nhưng lại làm tỉ lệ sao chép theo thuật toán của turnitindotcom > 30% ( theo thầy nói bài > 30 % sẽ bị 0 điểm ) .\n","Sentiment: negative\n","\n","Sentence: cho ôn tập một đường ra đề một kiểu .\n","Sentiment: negative\n","\n","Sentence: slide bao nhiêu thầy đọc lại bấy nhiêu , cực kỳ khó hiểu và buồn ngủ .\n","Sentiment: negative\n","\n","Sentence: giảng viên giảng dạy nhiệt tình , giải đáp được thắc mắc của sinh viên .\n","Sentiment: positive\n","\n","\n","Sentence: nói tiếng anh lưu loát .\n","### Model Output:\n","Sentiment: neutral\n","### Label:\n","positive\n","\n","*** Few-shot evaluation results with 8 shots:\n","* accuracy: 0.4700\n","* f1: 0.3157\n","* precision: 0.4298\n","* recall: 0.3943\n","\n"]}]},{"cell_type":"code","source":[],"metadata":{"id":"FUYQVn4ye_p_"},"execution_count":null,"outputs":[]}],"metadata":{"accelerator":"GPU","colab":{"gpuType":"T4","provenance":[]},"kernelspec":{"display_name":"base","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.12.2"},"widgets":{"application/vnd.jupyter.widget-state+json":{"0083a0df9b98448b8a5a8a284b29f8ef":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_4a89824878a14847b9a0d487b150a3fe","IPY_MODEL_cc0aecb0df2e4bb78c1e7819b7a9b8f8","IPY_MODEL_54e461780f5c47929013f8fe24a451e2"],"layout":"IPY_MODEL_c7948f8a7a324ed0a384f2a7b40d0556"}},"4a89824878a14847b9a0d487b150a3fe":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_6aec4b056dae40f093aa79031dbcd964","placeholder":"​","style":"IPY_MODEL_90a4a08face54bf5851c3b935b1b0d8e","value":"Downloading builder script: 100%"}},"cc0aecb0df2e4bb78c1e7819b7a9b8f8":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_0f3e52de16aa4681bc19f2caa8f45c37","max":4203,"min":0,"orientation":"horizontal","style":"IPY_MODEL_c0ab3f9791674e65ae88e1ec2970574b","value":4203}},"54e461780f5c47929013f8fe24a451e2":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_eee08da7f3f84ca2987a21223149259d","placeholder":"​","style":"IPY_MODEL_ff5b66f15e0e4f0b970677c7b0212715","value":" 4.20k/4.20k [00:00&lt;00:00, 363kB/s]"}},"c7948f8a7a324ed0a384f2a7b40d0556":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6aec4b056dae40f093aa79031dbcd964":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"90a4a08face54bf5851c3b935b1b0d8e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"0f3e52de16aa4681bc19f2caa8f45c37":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c0ab3f9791674e65ae88e1ec2970574b":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"eee08da7f3f84ca2987a21223149259d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ff5b66f15e0e4f0b970677c7b0212715":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4a986c7de9e04fe9aafbdbb7005b4deb":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_cb5410ea8e954682978f2721e57c0a7a","IPY_MODEL_ec0ff6f96cea4f8dbef8d91359aae239","IPY_MODEL_8ea86e7825b949fb933a5e6994623304"],"layout":"IPY_MODEL_a36f730f59cf4a2daac580d20d59f4e8"}},"cb5410ea8e954682978f2721e57c0a7a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_8c0e1cefa7084fa5a894c1d99dde99a8","placeholder":"​","style":"IPY_MODEL_aa40df8032f3468795265e4e421395ca","value":"Downloading builder script: 100%"}},"ec0ff6f96cea4f8dbef8d91359aae239":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_cea35a079f24490b90e47dc8b13637c9","max":6785,"min":0,"orientation":"horizontal","style":"IPY_MODEL_bd14c55f9e174caaba33090f13155f05","value":6785}},"8ea86e7825b949fb933a5e6994623304":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_544af628c8534777a3ac47447d606512","placeholder":"​","style":"IPY_MODEL_96cfd3fac2944288b624396146f42567","value":" 6.79k/6.79k [00:00&lt;00:00, 710kB/s]"}},"a36f730f59cf4a2daac580d20d59f4e8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8c0e1cefa7084fa5a894c1d99dde99a8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"aa40df8032f3468795265e4e421395ca":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cea35a079f24490b90e47dc8b13637c9":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"bd14c55f9e174caaba33090f13155f05":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"544af628c8534777a3ac47447d606512":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"96cfd3fac2944288b624396146f42567":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"ff01f948eb7e4a3d87afbcf02601febe":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_af847d51e5b84e9b99dd5caf0231da39","IPY_MODEL_32593ec0e8684efa80784f3dc69c1344","IPY_MODEL_1bf5cabd3cd2439d8c6b249bcc59be96"],"layout":"IPY_MODEL_2ec28846a95643d8aabae4922469a18c"}},"af847d51e5b84e9b99dd5caf0231da39":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f4f4ae50ce704686a8db52301cee7bd4","placeholder":"​","style":"IPY_MODEL_d83ca71481994ba0a363e092a2ab0a7c","value":"Downloading builder script: 100%"}},"32593ec0e8684efa80784f3dc69c1344":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_4de2aa0ec429454084045e6ab02620e3","max":7560,"min":0,"orientation":"horizontal","style":"IPY_MODEL_68fd652a12b94590b0c5e560bae94e6e","value":7560}},"1bf5cabd3cd2439d8c6b249bcc59be96":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_ed3081bc935e494b81208f60580e5927","placeholder":"​","style":"IPY_MODEL_fbea57d500e84535a9e1a5c0446969da","value":" 7.56k/7.56k [00:00&lt;00:00, 752kB/s]"}},"2ec28846a95643d8aabae4922469a18c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f4f4ae50ce704686a8db52301cee7bd4":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d83ca71481994ba0a363e092a2ab0a7c":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4de2aa0ec429454084045e6ab02620e3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"68fd652a12b94590b0c5e560bae94e6e":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"ed3081bc935e494b81208f60580e5927":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"fbea57d500e84535a9e1a5c0446969da":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"ef3fbff21242444b8acb1cf4cacaa2a9":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_feab66bf82a2481eb4ccfabb07be2a5e","IPY_MODEL_a8ecbb89b1024243ab39a7fdbbacb954","IPY_MODEL_ae6830bd73e54a53bad1383938bb69ed"],"layout":"IPY_MODEL_cfcc692aa3c5475f8bbd138a2ada8762"}},"feab66bf82a2481eb4ccfabb07be2a5e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_20b5a40747514ad4a50816264c9d923e","placeholder":"​","style":"IPY_MODEL_d653f108f9e74850a0a27586914e5bd0","value":"Downloading builder script: 100%"}},"a8ecbb89b1024243ab39a7fdbbacb954":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_060a7f320a0a4486ba04ff4bb43fbe45","max":7377,"min":0,"orientation":"horizontal","style":"IPY_MODEL_44e7db62ef6e447dbce21d56ef0d394e","value":7377}},"ae6830bd73e54a53bad1383938bb69ed":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_ba484c493dc94d3081b06e09f88b20de","placeholder":"​","style":"IPY_MODEL_a3e443d0515a4526bf300f21b5a2ced2","value":" 7.38k/7.38k [00:00&lt;00:00, 777kB/s]"}},"cfcc692aa3c5475f8bbd138a2ada8762":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"20b5a40747514ad4a50816264c9d923e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d653f108f9e74850a0a27586914e5bd0":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"060a7f320a0a4486ba04ff4bb43fbe45":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"44e7db62ef6e447dbce21d56ef0d394e":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"ba484c493dc94d3081b06e09f88b20de":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a3e443d0515a4526bf300f21b5a2ced2":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"nbformat":4,"nbformat_minor":0}